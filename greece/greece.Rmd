---
title: "Geospatial Data with ggmap & tmap"
author: "Fisher Ankney"
date: "3/11/2018"
output: html_document
---

<br> 

I recently completed Data Camp's short course on [*Working With Geospatial Data in R*] ](https://www.datacamp.com/courses/working-with-geospatial-data-in-r), taught by Charolette Whickham. The course was about four hours long and introduced a variety of packages and methods for geospatial analysis in R. It was an engaging short course that was well worth my time, even though I'm not hoping to specialize in spatial analyis. Finding, loading, and wrangling spatial data has a steep learning curve, but is really fun once you get the hang of it. 

To help cement these blossoming skills, I'm going to create several visualizations to help me plan my next hypothetical trip abroad! First I need to load some essential spatial analysis packages. The packages `ggmap`, `sp`, `tmap`, `rgdal`, `classInt`, and `viridisLite` were all covered in Data Camp's geospatial course. The course also covered `raster`, `tigris`, and `RColorBrewer`, but I'm not going to use them in this post.

```{r, message=F}
library('tidyverse')    
library('ggmap')
library('sp')
library('tmap')
library('rgdal')
library('classInt')
library('viridisLite')
```

<br> 

Now that I've got the packages loaded, let's load some data and have a look at the world to get the wanderlust flowing. 

```{r}
# Load World dataset from package tmap
data("World")

# Plot the world according to population
tm_shape(World) + 
  tm_borders() +
  tm_fill(title = "Population Estimate", 
          col = "pop_est", 
          style = "fisher",
          labels = c("0 - 33 Million",
                     "33 - 105 Million",
                     "105 - 220 Million", 
                     "220 - 740 Million", 
                     "740 - 1,339 Million"
                     )
          ) + 
  tm_style_natural() + 
  tm_compass() + 
  tm_layout(frame = F)
```

This is a pretty cool map, informative and pleasing to the eye. I think the `fisher` method of processing the color breaks for population was a good choice. Now let's see the world divided up by economic development! I just recently got back from a trip to South East Asia, and I'm looking to go somewhere a little bit more developed this time! 

```{r}
# Create a custom color palette
vir <- viridis(5)

# Plot the world based on economic development
tm_shape(World) + 
  tm_borders() + 
  tm_compass() + 
  tm_fill(title ="Economic Development",
          col = "economy",
          palette = vir,
          style = "quantile"
          ) 
```

I really like the `viridisLite` color palettes, They're specially designed to work with all types of color-blindness and translate to grayscale well. After viewing this plot of economic development, I'm thinking that a trip to Europe will be in my near future! But what part of Europe?

```{r}
# Load tmap package data on Europe
data(Europe)

# Plot a map of Europe based on geographic divisions
tm_shape(Europe) + 
  tm_borders() + 
  tm_fill(title = "Part",
          col = "part",
          palette = vir,
          textNA = "Not Europe"
          ) + 
  tm_style_white() 
```

Don't let Czechia know that the `tmap` package considers them Eastern Europe! Of course these divisions come from the United Nations Statistical Division, and don't include a category for Central Europe. Moving foward, I think a trip to Southern Europe would be just what I'm looking for! 

```{r, message=F}
s_europe <- Europe$part == "Southern Europe"
s_europe

for (i in seq_along(s_europe)) {
  if ( is.na(s_europe[[i]]) ) {
    s_europe[[i]] <- FALSE
  } 
}

```


```{r}
# Reset the color palette for 4 variables
vir <- viridis(4)

# Map Southern Europe
tm_shape(Europe[s_europe,]) + 
  tm_borders() +   
  tm_fill(title = "Population Estimate",
          col = "pop_est", 
          palette = vir
          labels = c("0 - 20 Million",
                     "20 - 40 Million", 
                     "40 - 60 Million", 
                     "60 - 80 Million")
          ) + 
  tm_style_white() + 
  tm_text("iso_a3", size="AREA", root=5) +
  tm_layout(title = "Southern Europe by Population",
            inner.margins = c(0.05, 0.1, 0.25, 0.05),
            scale = 0.85
            )
  
```

<br> 

Greece! I want to go to greece (for the third time...)

```{r, message=F}

grc_shape <- readOGR("input/periphereies", "periphereies")

summary(grc_shape)

str(grc_shape, max.level = 2)

tm_shape(grc_shape, simplify = .5) + 
  tm_borders(lwd = 1, col = "#ffffff") + 
  tm_fill(col = "#0D5EAF") 
```

http://geodata.gov.gr/en/dataset?tags=administrative-units

<br> 


but where to stay? I'm going to fly into Athens, are there any airbnb's around? 
```{r}
athens_airbnb <- read_csv("input/airbnb_data.csv")
athens_coord <- c(lon = 23.7275, lat = 37.9838)

classIntervals(athens_airbnb$price, n = 5, style = "quantile")
breaks <- c(9,25,35,46,69,5000)
labels <- c("$9 - $25", "$25 - $35", "$35 - $46", "$46 - $69", "$69+")
athens_airbnb$price <- cut(athens_airbnb$price, breaks = breaks, labels = labels)
athens_airbnb$price

athens <- get_map(athens_coord, zoom = 13, scale = 1, maptype="terrain")

ggmap(athens) + 
  geom_point(data = athens_airbnb, 
             aes(longitude, latitude, col = price), 
             alpha = 0.3) + 
  scale_color_manual(values = c("#0D0887FF", "#7E03A8FF", "#CC4678FF", "#F89441FF", "#F0F921FF"))

```
http://insideairbnb.com/get-the-data.html

<br> 

But I only want to stay in a swanky place that has been reviewd so i know its legit
```{r}
athens_airbnb <- read_csv("input/airbnb_data.csv")
athens_zoom <- get_map(athens_coord, zoom = 14, scale = 1, maptype="terrain")

swanky_bnb <- athens_airbnb %>%
  filter(price > 150 & number_of_reviews > 5)
swanky_bnb

ggmap(athens_zoom) + 
  geom_point(data = swanky_bnb, 
             aes(longitude, latitude, col = price), 
             alpha = 0.8, 
             size = 6) + 
    scale_color_continuous(low = "#0D0887FF", high = "#F0F921FF")
```



in fact, ill make my own souvinere 
```{r}
santorini_coord <- c(lon = 25.4115, lat = 36.4052)

santorini <- get_map(santorini_coord, zoom = 12, scale = 1, maptype="watercolor")

ggmap(santorini)

```

Athens street map artsy
```{r}
athens_coord <- c(lon = 23.7275, lat = 37.9838)

greece <- get_map(athens_coord, zoom = 12, scale = 1, maptype = "terrain-lines")

ggmap(greece) 
```
