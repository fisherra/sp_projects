---
title: "Geospatial Data with ggmap & tmap"
author: "Fisher Ankney"
date: "3/11/2018"
output: html_document
---

<br> 

I recently completed Data Camp's short course on [*Working With Geospatial Data in R*] ](https://www.datacamp.com/courses/working-with-geospatial-data-in-r), taught by Charolette Whickham. The course was about four hours in length and covered a variety of packages and methods for geospatial analysis in R. I found it really interesting and well worth my time, even though I'm not hoping to deeply specialize in spatial analyis. Finding, loading, and wrangling spatial data into a map can be really fun, but also quiet a hasel. I've taken the time to apply some of the techniques I've learned from the short course in this post. Enjoy! 

Let's pretend I'm attempting to figure out my next exoctic travel destination, but I can only use R to help! First, I need to load some R packages!

```{r, message=F}
library('tidyverse')    
library('ggmap')
library('sp')
library('tmap')
library('rgdal')
library('classInt')
library('viridisLite')
```

<br> 

The packages `ggmap`, `sp`, `tmap`, `rgdal`, `classInt`, and `viridisLite` were all covered in Data Camp's geospatial course. The course also covered `raster`, `tigris`, and `RColorBrewer`, but I'm not going to use them in this post. Now that I've got the packages loaded, let's take a look at a plot of the Earth! Where to go, where to go? 

```{r}
# Load World dataset from package tmap
data("World")

# Plot the world 
tm_shape(World) + 
  tm_borders() +
  tm_fill(col = "pop_est", style = "fisher") + 
  tm_style_natural() + 
  tm_compass()
```

<br> 

Let's see, I want to go somewhere developed this time! 

```{r}

vir <- viridis(5)


tm_shape(World) + 
  tm_borders() + 
  tm_compass() + 
  tm_fill(col = "economy", palette = vir, style = "quantile")
```

<br> 

Particularly southern Europe! 
```{r}
data(Europe)

tm_shape(Europe) + 
  tm_borders() + 
  tm_fill(col = "part") + 
  tm_style_white()
```
I want to go somewhere where the people are happy, but also where it's nice and warm! 

```{r}
data(Europe)

s_europe <- Europe$part == "Southern Europe"
s_europe

for (i in seq_along(s_europe)) {
  if ( is.na(s_europe[[i]]) ) {
    s_europe[[i]] <- FALSE
  } 
}

tm_shape(Europe[s_europe,]) + 
  tm_borders() +   
  tm_fill(col = "well_being") + 
  tm_style_white()
```

<br> 

Greece! I want to go to greece (for the third time...)

```{r, message=F}

grc_shape <- readOGR("input/periphereies", "periphereies")

summary(grc_shape)

str(grc_shape, max.level = 2)

tm_shape(grc_shape) + 
  tm_borders(lwd = 1, col = "#ffffff") + 
  tm_fill(col = "#0D5EAF") 
```

http://geodata.gov.gr/en/dataset?tags=administrative-units

<br> 


but where to stay? I'm going to fly into Athens, are there any airbnb's around? 
```{r}
athens_airbnb <- read_csv("input/airbnb_data.csv")
athens_coord <- c(lon = 23.7275, lat = 37.9838)

classIntervals(athens_airbnb$price, n = 5, style = "quantile")
breaks <- c(9,25,35,46,69,5000)
labels <- c("$9 - $25", "$25 - $35", "$35 - $46", "$46 - $69", "$69+")
athens_airbnb$price <- cut(athens_airbnb$price, breaks = breaks, labels = labels)
athens_airbnb$price

athens <- get_map(athens_coord, zoom = 13, scale = 1, maptype="terrain")

ggmap(athens) + 
  geom_point(data = athens_airbnb, 
             aes(longitude, latitude, col = price), 
             alpha = 0.3) + 
  scale_color_manual(values = c("#0D0887FF", "#7E03A8FF", "#CC4678FF", "#F89441FF", "#F0F921FF"))

```
http://insideairbnb.com/get-the-data.html

<br> 

But I only want to stay in a swanky place that has been reviewd so i know its legit
```{r}
athens_airbnb <- read_csv("input/airbnb_data.csv")
athens_zoom <- get_map(athens_coord, zoom = 14, scale = 1, maptype="terrain")

swanky_bnb <- athens_airbnb %>%
  filter(price > 150 & number_of_reviews > 5)
swanky_bnb

ggmap(athens_zoom) + 
  geom_point(data = swanky_bnb, 
             aes(longitude, latitude, col = price), 
             alpha = 0.8, 
             size = 6) + 
    scale_color_continuous(low = "#0D0887FF", high = "#F0F921FF")
```



in fact, ill make my own souvinere 
```{r}
santorini_coord <- c(lon = 25.4115, lat = 36.4052)

santorini <- get_map(santorini_coord, zoom = 12, scale = 1, maptype="watercolor")

ggmap(santorini)

```

Athens street map artsy
```{r}
athens_coord <- c(lon = 23.7275, lat = 37.9838)

greece <- get_map(athens_coord, zoom = 12, scale = 1, maptype = "terrain-lines")

ggmap(greece) 
```
